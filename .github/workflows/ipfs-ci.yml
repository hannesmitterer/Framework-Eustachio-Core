name: IPFS Integration CI

on:
  push:
    branches: [ main, copilot/** ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: Test IPFS Functionality
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: |
        echo "ğŸ“¦ Installing dependencies..."
        npm install
        echo "âœ… Dependencies installed"
        
    - name: Verify dependency installation
      run: |
        echo "ğŸ” Verifying ipfs-http-client installation..."
        npm list ipfs-http-client
        echo "ğŸ“‹ All installed packages:"
        npm list --depth=0
        
    - name: Run ESLint
      run: |
        echo "ğŸ” Running ESLint..."
        npm run lint
        
    - name: Run IPFS Tests
      run: |
        echo "ğŸ§ª Running IPFS functionality tests..."
        npm test
        echo "âœ… Tests completed"
        
    - name: Test Output Summary
      if: always()
      env:
        JOB_STATUS: ${{ job.status }}
      run: |
        echo "## Test Summary" >> "$GITHUB_STEP_SUMMARY"
        if [ "$JOB_STATUS" = "success" ]; then
          STATUS_ICON="âœ…"
        elif [ "$JOB_STATUS" = "failure" ]; then
          STATUS_ICON="âŒ"
        else
          STATUS_ICON="âš ï¸"
        fi
        echo "- Overall Test Status: $STATUS_ICON ($JOB_STATUS)" >> "$GITHUB_STEP_SUMMARY"

  lint:
    name: Code Quality Check
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: npm install
      
    - name: Run ESLint with detailed output
      run: |
        echo "ğŸ” Running detailed ESLint analysis..."
        npm run lint
        echo "âœ… Linting analysis complete"
